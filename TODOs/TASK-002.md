# TASK-002: Снимки мира и client-side prediction

## Описание
Добавить в протокол сообщения `WorldSnapshotMessage` и `ClientInputMessage` и реализовать базовый client-side prediction с server reconciliation.

## Цели
1. Снизить визуальный лаг до <75 мс при RTT 50–150 мс.
2. Подготовить инфраструктуру для rollback-netcode.

## Файлы/Папки
- internal/network/
- internal/protocol/
- client/

## Подзадачи
1. [x] Определить формат сообщений в .proto. ✅
2. [x] Модифицировать сериализатор (`MessageSerializer`). ✅
3. [x] Реализовать очередь инпутов и ack в `GameHandlerPB`. ✅
4. [x] Добавить prediction и буфер снапшотов в клиенте. ✅
5. [x] Механизм мягкой коррекции позиции (LERP 100 мс). ✅
6. [x] Инструмент визуализации ошибки предсказания. ✅

## Реализованные компоненты

### 1. Протокол prediction.proto
- ClientInputMessage - ввод от клиента с типами движения/взаимодействия
- WorldSnapshotMessage - снимки мира с состоянием игрока и видимых сущностей
- InputAckMessage - подтверждение обработки ввода с коррекцией
- PredictionStatsMessage - статистика для отладки
- BlockDelta - дельта изменений блоков в снимках

### 2. Серверная часть (internal/network/)
- PredictionService - основной сервис обработки prediction
- GameHandlerPrediction - интеграция с GameHandlerPB
- PredictionVisualizer - веб-интерфейс для отладки

### 3. Клиентская часть (client/)
- ClientPrediction - полная система prediction на клиенте
- Буферизация неподтвержденных вводов
- Reconciliation с переигрыванием вводов
- Мягкая коррекция позиции с LERP

### 4. Характеристики производительности
- Обработка ввода: ~2300 ns/op
- Получение снимка: ~6 ns/op  
- Статистика: ~42 ns/op
- Частота снимков: 20Hz (50ms)
- Буфер вводов: 64 ввода
- Буфер снимков: 32 снимка

### 5. Веб-мониторинг
- Визуализация ошибок prediction в реальном времени
- Статистика по игрокам
- API для сброса истории
- Автообновление интерфейса

## Приоритет
P1

## Сложность
5/5

## Зависимости
TASK-001

## История изменений
- 2025-06-20: задача создана. 