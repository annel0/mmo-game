# 2D MMO Server –Ω–∞ Go

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è 2D MMO –∏–≥—Ä—ã, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —è–∑—ã–∫–µ Go —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–≥–æ—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, client-side prediction –∏ KCP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –°–µ—Ç–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **KCP Protocol** - –ù–∞–¥–µ–∂–Ω—ã–π UDP –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –∏–≥—Ä–æ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
- **Client-Side Prediction** - –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ —Å —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ü–∏–µ–π
- **NetChannel System** - –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞–Ω–∞–ª–æ–≤ (KCP, TCP, UDP, WebSocket)
- **Adaptive Networking** - –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Å–µ—Ç–∏

### –ú–Ω–æ–≥–æ—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **Regional Nodes** - –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–∑–ª—ã –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –º–∏—Ä–∞
- **Cross-Region Sync** - –ë–∞—Ç—á-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏ —Å –∫–æ–º–ø—Ä–µ—Å—Å–∏–µ–π
- **Distributed Caching** - Redis –¥–ª—è –≥–æ—Ä—è—á–∏—Ö –¥–∞–Ω–Ω—ã—Ö + —Ö–æ–ª–æ–¥–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- **Conflict Resolution** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (Last-Write-Wins)

### –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞
- **–ú–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã–µ –±–ª–æ–∫–∏** - –¢—Ä–µ—Ö—Å–ª–æ–π–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (FLOOR, ACTIVE, CEILING)
- **Spatial Indexing** - –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è 5000+ –∏–≥—Ä–æ–∫–æ–≤
- **Entity System** - –°–∏—Å—Ç–µ–º–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π —Å –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è–º–∏
- **Game Actions** - 9 —Ç–∏–ø–æ–≤ –∏–≥—Ä–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (–∞—Ç–∞–∫–∞, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ, —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ)

### –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **Event System** - NATS JetStream –¥–ª—è —Å–æ–±—ã—Ç–∏–π –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **Event Replay** - –°–∏—Å—Ç–µ–º–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π —Å CLI —É—Ç–∏–ª–∏—Ç–æ–π
- **Prometheus Metrics** - –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **OpenTelemetry** - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞
- **Structured Logging** - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º

### –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **Redis** - –ü–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–æ–≤ –∏ –≥–æ—Ä—è—á–∏–µ –¥–∞–Ω–Ω—ã–µ
- **MariaDB** - –î–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
- **Batching** - –ë–∞—Ç—á–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **Transactions** - ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **WorldManager** - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –≤—Å–µ–º –º–∏—Ä–æ–º
- **BigChunk** - –µ–¥–∏–Ω–∏—Ü–∞ —Å–∏–º—É–ª—è—Ü–∏–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è 32x32 —á–∞–Ω–∫–æ–≤
- **Chunk** - —É—á–∞—Å—Ç–æ–∫ –º–∏—Ä–∞ —Ä–∞–∑–º–µ—Ä–æ–º 16x16 –±–ª–æ–∫–æ–≤
- **Block** - –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫ —Å ID –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (payload)
- **BlockBehavior** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–ª–æ–∫–∞
- **BlockAPI** - API –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –±–ª–æ–∫–æ–≤ —Å –º–∏—Ä–æ–º
- **Event** - —Å–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –ò–µ—Ä–∞—Ä—Ö–∏—è –º–∏—Ä–∞

```
WorldManager
‚îî‚îÄ‚îÄ BigChunk (32x32 —á–∞–Ω–∫–æ–≤)
    ‚îî‚îÄ‚îÄ Chunk (16x16 –±–ª–æ–∫–æ–≤)
        ‚îî‚îÄ‚îÄ Block (1x1) - —Ç—Ä–µ—Ö—Å–ª–æ–π–Ω—ã–π
            ‚îú‚îÄ‚îÄ FLOOR (–æ—Å–Ω–æ–≤–∞–Ω–∏–µ)
            ‚îú‚îÄ‚îÄ ACTIVE (–æ–±—ä–µ–∫—Ç—ã)
            ‚îî‚îÄ‚îÄ CEILING (–∫—Ä—ã—à–∞)
```

### –°–µ—Ç–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Client ‚Üê‚Üí KCP Channel ‚Üê‚Üí GameHandler ‚Üê‚Üí WorldManager
                                    ‚Üì
                               Regional Node ‚Üê‚Üí Cross-Region Sync
                                    ‚Üì
                               Event System (NATS JetStream)
```

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### NetChannel System

–ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–µ—Ç–µ–≤—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- **KCP Channel** - –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª –¥–ª—è –∏–≥—Ä–æ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
- **TCP Channel** - –ù–∞–¥–µ–∂–Ω—ã–π –∫–∞–Ω–∞–ª –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **UDP Channel** - –ë—ã—Å—Ç—Ä—ã–π –∫–∞–Ω–∞–ª –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **WebSocket Channel** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–æ–≤

### Client-Side Prediction

- **Optimistic Updates** - –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞
- **Server Reconciliation** - –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π —Å–µ—Ä–≤–µ—Ä–æ–º
- **Lag Compensation** - –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫ —Å–µ—Ç–∏
- **Rollback System** - –û—Ç–∫–∞—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π

### Game Actions System

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –¥–µ–π—Å—Ç–≤–∏–π:
- **INTERACT** - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –∏ NPC
- **ATTACK** - –°–∏—Å—Ç–µ–º–∞ –∞—Ç–∞–∫ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
- **USE_ITEM** - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- **PICKUP/DROP** - –ü–æ–¥–±–æ—Ä –∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- **BUILD_PLACE/BUILD_BREAK** - –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∏ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ
- **EMOTE** - –°–∏—Å—Ç–µ–º–∞ —ç–º–æ—Ü–∏–π
- **RESPAWN** - –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤

### Vec2

–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç 2D –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:
- `ToChunkCoords` - –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —á–∞–Ω–∫–∞
- `ToBigChunkCoords` - –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã BigChunk
- `LocalInChunk` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —á–∞–Ω–∫–∞

### Block

–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –±–ª–æ–∫ –≤ –∏–≥—Ä–æ–≤–æ–º –º–∏—Ä–µ:
- `ID` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∏–ø–∞ –±–ª–æ–∫–∞
- `Payload` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∞ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- `Layer` - —Å–ª–æ–π –±–ª–æ–∫–∞ (FLOOR, ACTIVE, CEILING)

### BlockBehavior

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–ª–æ–∫–∞:
- `ID()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞
- `Name()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–º—è –±–ª–æ–∫–∞
- `NeedsTick()` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —Ç—Ä–µ–±—É–µ—Ç –ª–∏ –±–ª–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ç–∏–∫–∞—Ö
- `TickUpdate()` - –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∞ –ø—Ä–∏ —Ç–∏–∫–µ
- `OnPlace()` - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –±–ª–æ–∫–∞
- `OnBreak()` - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–∏ –±–ª–æ–∫–∞
- `OnInteract()` - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –±–ª–æ–∫–æ–º
- `CreateMetadata()` - —Å–æ–∑–¥–∞–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

### BlockAPI

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –±–ª–æ–∫–æ–≤ —Å –º–∏—Ä–æ–º:
- `GetBlockID()` - –ø–æ–ª—É—á–∞–µ—Ç ID –±–ª–æ–∫–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
- `SetBlock()` - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –±–ª–æ–∫ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
- `GetBlockMetadata()` - –ø–æ–ª—É—á–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∞
- `SetBlockMetadata()` - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∞
- `GetBlockIDLayer()` / `SetBlockLayer()` ‚Äì —Ä–∞–±–æ—Ç–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Å–ª–æ–µ–º
- `ScheduleUpdateOnce()` ‚Äì –ø–æ–º–µ—á–∞–µ—Ç –±–ª–æ–∫ –¥–ª—è **—Ä–∞–∑–æ–≤–æ–≥–æ** –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ç–∏–∫–µ
- `TriggerNeighborUpdates()` ‚Äì –ø–ª–∞–Ω–∏—Ä—É–µ—Ç —Ä–∞–∑–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è —á–µ—Ç—ã—Ä—ë—Ö —Å–æ—Å–µ–¥–Ω–∏—Ö –±–ª–æ–∫–æ–≤

### Chunk

–•—Ä–∞–Ω–∏—Ç –º–∞—Ç—Ä–∏—Ü—É –±–ª–æ–∫–æ–≤ **–≤ —Ç—Ä—ë—Ö –∏–∑–º–µ—Ä–µ–Ω–∏—è—Ö** (`Blocks3D[layer][x][y]`) –∏ –∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:
- `Blocks3D` ‚Äì —Ç—Ä—ë—Ö–º–µ—Ä–Ω—ã–π –º–∞—Å—Å–∏–≤ ID –±–ª–æ–∫–æ–≤ (–¥–æ 4 —Å–ª–æ—ë–≤)
- `Metadata3D` ‚Äì –∫–∞—Ä—Ç–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º–∞—è `BlockCoord{Layer, Pos}`
- `Tickable3D` ‚Äì —Ç–∏–∫–∞–µ–º—ã–µ –±–ª–æ–∫–∏ (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- `Changes3D` ‚Äì –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –±–ª–æ–∫–∏ (–¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–µ–ª—å—Ç)

### BigChunk

–ï–¥–∏–Ω–∏—Ü–∞ —Å–∏–º—É–ª—è—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç 32x32 —á–∞–Ω–∫–∞:
- –ò–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –≥–æ—Ä—É—Ç–∏–Ω—É
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –±–ª–æ–∫–æ–≤ –∏ —Å—É—â–Ω–æ—Å—Ç–µ–π
- –£–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–∏–∫–∞–º–∏ –¥–ª—è –±–ª–æ–∫–æ–≤ –∏ —Å—É—â–Ω–æ—Å—Ç–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –±–ª–æ–∫–∞–º–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

### WorldManager

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—â–∏–π –º–∏—Ä:
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–º–∏ BigChunk'–∞–º–∏
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–∏–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ —É–∑–ª–∞–º–∏

### –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π

–ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º:
- `BlockEvent` - —Å–æ–±—ã—Ç–∏—è –±–ª–æ–∫–æ–≤ (–∏–∑–º–µ–Ω–µ–Ω–∏–µ, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ)
- `EntityEvent` - —Å–æ–±—ã—Ç–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π (–ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ, —Å–ø–∞–≤–Ω)
- `TickEvent` - –∏–≥—Ä–æ–≤–æ–π —Ç–∏–∫
- `SaveEvent` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `SystemEvent` - —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

## üóÑÔ∏è –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### Redis (–ì–æ—Ä—è—á–∏–µ –¥–∞–Ω–Ω—ã–µ)
- –ü–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ö—ç—à —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- GEO –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ë–∞—Ç—á–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### MariaDB (–î–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ)
- –ü—Ä–æ—Ñ–∏–ª–∏ –∏–≥—Ä–æ–∫–æ–≤ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –°–æ—Å—Ç–æ—è–Ω–∏—è —á–∞–Ω–∫–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Hot Cache** - Redis –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **Cold Storage** - MariaDB –¥–ª—è –∞—Ä—Ö–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **Cache Invalidation** - NATS –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞
- **TTL Management** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –û–¥–∏–Ω–æ—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
```bash
# –ó–∞–ø—É—Å–∫ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
go run cmd/server/main.go

# –ó–∞–ø—É—Å–∫ —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
go run cmd/server/main.go -config config.yml
```

### –ú–Ω–æ–≥–æ—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```bash
# –ó–∞–ø—É—Å–∫ EU-West —Å–µ—Ä–≤–µ—Ä–∞
go run cmd/server/main.go -config config-eu-west.yml

# –ó–∞–ø—É—Å–∫ US-East —Å–µ—Ä–≤–µ—Ä–∞
go run cmd/server/main.go -config config-us-east.yml
```

### –£—Ç–∏–ª–∏—Ç—ã
```bash
# –ê–Ω–∞–ª–∏–∑ —Å–æ–±—ã—Ç–∏–π
go run cmd/tools/event-cli/main.go tail --types=world,block
go run cmd/tools/event-cli/main.go stats --region=eu-west
```

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
make test

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
make test-coverage

# E2E —Ç–µ—Å—Ç—ã
make test-e2e

# –¢–µ—Å—Ç—ã –Ω–∞ –≥–æ–Ω–∫–∏
make test-race
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ (Prometheus)
- –î–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –ø–æ—Ä—Ç—É 2112 (`/metrics`)
- –ú–µ—Ç—Ä–∏–∫–∏ —Å–µ—Ç–∏, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ NetChannel, RegionalNode, EventBus

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º
- –†–∞–∑–ª–∏—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (Debug, Info, Warn, Error)
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞–º–∏

### –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞
- OpenTelemetry –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Jaeger/Zipkin
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ HTTP/gRPC –∑–∞–ø—Ä–æ—Å–æ–≤

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ë–µ–Ω—á–º–∞—Ä–∫–∏
- **Regional Sync**: ~355K –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫
- **NetChannel**: –Ω–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —Å KCP
- **Spatial Index**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 5000+ –∏–≥—Ä–æ–∫–æ–≤
- **Event System**: –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ë–∞—Ç—á–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ë–î
- –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–æ–º–ø—Ä–µ—Å—Å–∏—è –º–µ–∂—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ—Ä—è—á–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- JWT —Ç–æ–∫–µ–Ω—ã —Å HMAC-SHA256
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (1000 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö, 5 —Å IP)
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- –¢–∞–π–º–∞—É—Ç—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∑–∏—Ü–∏–π –±–ª–æ–∫–æ–≤ (—Ä–∞–¥–∏—É—Å 10 –±–ª–æ–∫–æ–≤)
- –í–∞–ª–∏–¥–∞—Ü–∏—è ID –±–ª–æ–∫–æ–≤
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (1–ö–ë)

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `docs/multi-region-setup.md` - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–Ω–æ–≥–æ—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- `docs/implementation-report.md` - –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- `REST_API_SUMMARY.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API
- `OUTBOUND_WEBHOOKS_SUMMARY.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤–µ–±—Ö—É–∫–æ–≤

## üîÑ CI/CD

- GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- –õ–∏–Ω—Ç–∏–Ω–≥ —Å golangci-lint
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –°–±–æ—Ä–∫–∞ –∏ —Ä–µ–ª–∏–∑—ã –ø–æ —Ç–µ–≥–∞–º

## üè∑Ô∏è –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ. –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: **v0.3.0-alpha**

### –î–≤—É—Ö—Å–ª–æ–π–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 2025-06-16)

1. **LayerFloor** ‚Äì –±–∞–∑–æ–≤—ã–π —Å–ª–æ–π (–∑–µ–º–ª—è, –ø–µ—Å–æ–∫, –∫–∞–º–µ–Ω—å, –≤–æ–¥–∞, **–≥–ª—É–±–∏–Ω–Ω–∞—è –≤–æ–¥–∞**).
2. **LayerActive** ‚Äì –≤–µ—Ä—Ö–Ω–∏–π —Å–ª–æ–π —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (—Ç—Ä–∞–≤–∞, –¥–µ—Ä–µ–≤—å—è, —Ä—É–¥—ã).

–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤—ã—Å–æ—Ç:
```
DeepWaterMax    = 0.20 // –ì–ª—É–±–∏–Ω–Ω–∞—è –≤–æ–¥–∞, —Å—Ç–∞—Ç–∏—á–Ω–∞
ShallowWaterMax = 0.30 // –ú–µ–ª–∫–æ–≤–æ–¥—å–µ, –æ–±—ã—á–Ω–∞—è –≤–æ–¥–∞
ActiveStart     = 0.60 // –í—ã—à–µ ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ –±–ª–æ–∫–∏ (–¥–µ—Ä–µ–≤—å—è –∏ –¥—Ä.)
MountainStart   = 0.80 // –ì–æ—Ä—ã, –≤–æ–∑–º–æ–∂–Ω—ã —Ä—É–¥—ã
```

### –°–∏—Å—Ç–µ–º–∞ UpdateOnce

–ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ª–∏—à–Ω–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π, –≤–Ω–µ–¥—Ä–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ **—Ä–∞–∑–æ–≤—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π**:
1. –ë–ª–æ–∫ –≤—ã–∑—ã–≤–∞–µ—Ç `ScheduleUpdateOnce(pos)` (–∏–ª–∏ `TriggerNeighborUpdates`) –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏.
2. BigChunk –ø–æ–º–µ—â–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É –≤ `onceTickables`.
3. –í —Å–ª–µ–¥—É—é—â–µ–º —Ç–∏–∫–µ –º–µ—Ç–æ–¥ `TickUpdate` –±–ª–æ–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ä–æ–≤–Ω–æ **–æ–¥–∏–Ω** —Ä–∞–∑.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```go
func (b *WaterBehavior) OnBreak(api block.BlockAPI, pos vec.Vec2) {
    // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –≤—ã—á–µ—Ä–ø–Ω—É–ª –≤–æ–¥—É ‚Äì –æ–±–Ω–æ–≤–∏–º —Å–æ—Å–µ–¥–µ–π, —á—Ç–æ–±—ã –≥–ª—É–±–∏–Ω–Ω–∞—è –≤–æ–¥–∞ –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–∞—Å—å –≤ –æ–±—ã—á–Ω—É—é
    api.TriggerNeighborUpdates(pos)
}
```

### –ù–æ–≤—ã–µ –±–ª–æ–∫–∏

| ID | –ë–ª–æ–∫            | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏               |
|----|-----------------|---------------------------|
| 6  | DeepWater       | –°—Ç–∞—Ç–∏—á–Ω–∞—è ¬´–≥–ª—É–±–∏–Ω–Ω–∞—è¬ª –≤–æ–¥–∞|

–ì–ª—É–±–∏–Ω–Ω–∞—è –≤–æ–¥–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ–±—ã—á–Ω—É—é, –µ—Å–ª–∏ —Ä—è–¥–æ–º –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–¥—É—Ö/—Å—É—à–∞. 